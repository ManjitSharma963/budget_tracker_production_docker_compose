# 403 Forbidden Error Fix

## Problem
Getting `403 Forbidden` error when accessing:
- `http://www.trackmyexpenses.in:8080/api/auth/login`
- Origin: `http://www.trackmyexpenses.in`

## Root Causes
1. **CORS Configuration**: The origin `http://www.trackmyexpenses.in` was not in the allowed origins list
2. **Spring Security**: The application uses Spring Security with custom CORS filters
3. **Direct Port Access**: Request is going directly to port 8080, bypassing Nginx CORS headers

## Solutions Applied

### 1. Updated CORS Allowed Origins
Updated `docker-compose.yml` to include:
- `http://www.trackmyexpenses.in`
- `https://www.trackmyexpenses.in`
- `http://trackmyexpenses.in`
- `https://trackmyexpenses.in`

### 2. Created Spring Boot Configuration File
Created `budget_tracker_production_api/application.properties` with:
```properties
# CORS Configuration
spring.cors.allowed-origins=http://www.trackmyexpenses.in,https://www.trackmyexpenses.in,http://trackmyexpenses.in,https://trackmyexpenses.in,http://139.59.85.102,http://localhost:3000,http://localhost
spring.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
spring.cors.allowed-headers=*
spring.cors.allow-credentials=true

# Server Configuration
server.port=8080

# Security Configuration
spring.security.csrf.enabled=false
```

### 3. Mounted Configuration File
Updated `docker-compose.yml` to mount the configuration file:
```yaml
volumes:
  - ./budget_tracker_production_api/application.properties:/app/application.properties:ro
```

## Testing

### Test CORS Preflight Request
```bash
curl -X OPTIONS http://www.trackmyexpenses.in:8080/api/auth/login \
     -H "Origin: http://www.trackmyexpenses.in" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -v
```

### Test Actual Request
```bash
curl -X POST http://www.trackmyexpenses.in:8080/api/auth/login \
     -H "Origin: http://www.trackmyexpenses.in" \
     -H "Content-Type: application/json" \
     -d '{"username":"test","password":"test"}' \
     -v
```

## Important Notes

1. **CustomCorsFilter**: The application has a `CustomCorsFilter` that might override Spring Boot's default CORS configuration. If the issue persists, the filter code in the GitHub repository may need to be updated.

2. **Spring Security**: The application uses Spring Security. If CSRF is still blocking requests, you may need to:
   - Update the security configuration in the repository
   - Or ensure the CustomCorsFilter handles CORS before Spring Security blocks the request

3. **Configuration Priority**: Spring Boot loads configuration in this order:
   - Environment variables (highest priority)
   - application.properties files
   - Default values (lowest priority)

4. **Direct Port Access**: Since requests are going directly to port 8080 (not through Nginx), the Spring Boot application must handle CORS itself. The Nginx CORS headers won't help here.

## If Issue Persists

If you still get 403 errors, check:

1. **Check Application Logs**:
   ```bash
   docker-compose logs -f budget_tracker_production_api
   ```

2. **Verify Configuration is Loaded**:
   ```bash
   docker exec budget_tracker_api cat /app/application.properties
   ```

3. **Check CustomCorsFilter Code**: The `CustomCorsFilter` in the GitHub repository might need to be updated to read from `application.properties` or environment variables.

4. **Spring Security Configuration**: The security configuration might need to allow the `/api/**` endpoints without authentication for CORS preflight requests.

## Alternative: Use Nginx Proxy

Instead of accessing port 8080 directly, use Nginx on port 80:
- Change frontend to use: `http://www.trackmyexpenses.in/api/auth/login`
- This way, Nginx CORS headers will handle the CORS, and the request will be proxied to the API

